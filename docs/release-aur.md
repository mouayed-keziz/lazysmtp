# Release Instructions for AUR

This guide explains how to release lazySMTP to the Arch User Repository (AUR).

## Prerequisites

1. **AUR Account**: Create an account at https://aur.archlinux.org
2. **SSH Key**: Set up an SSH key for AUR authentication
3. **Goreleaser**: Install goreleaser: `go install github.com/goreleaser/goreleaser@latest`
4. **AUR Package**: Create the package in AUR: `git clone ssh://aur@aur.archlinux.org/lazysmtp-git.git`

## Setup AUR SSH Key

1. Generate an SSH key if you don't have one:
   ```bash
   ssh-keygen -t ed25519 -C "your@email.com" -f ~/.ssh/aur
   ```

2. Add the public key to your AUR account settings

3. Add to SSH config:
   ```
   Host aur.archlinux.org
       User aur
       IdentityFile ~/.ssh/aur
   ```

## Environment Variables

Set up the following environment variables:

```bash
export AUR_PRIVATE_KEY=~/.ssh/aur
export GITHUB_TOKEN=your_github_token
export GIT_COMMIT_AUTHOR_NAME="Your Name"
export GIT_COMMIT_AUTHOR_EMAIL="your@email.com"
```

## Create AUR Package

1. Clone the AUR repository:
   ```bash
   git clone ssh://aur@aur.archlinux.org/lazysmtp-git.git
   cd lazysmtp-git
   ```

2. Create the PKGBUILD:
   ```bash
   # This will be auto-generated by goreleaser
   ```

## Release Process

### 1. Update Version

Update the version in `src/main.go`:

```go
var (
    version = "v1.0.0"
    commit  = ""
    date    = ""
)
```

### 2. Tag the Release

```bash
git tag -a v1.0.0 -m "Release v1.0.0"
git push origin v1.0.0
```

### 3. Test Release Locally

```bash
make release-snapshot
```

This will create a release in `dist/` without publishing.

### 4. Test Release (Dry Run)

```bash
make release-test
```

This will test the full release process but skip publishing.

### 5. Release

```bash
make release
```

This will:
- Build binaries for all platforms
- Create archives with checksums
- Upload to GitHub Releases
- Update AUR package

## AUR Maintenance

### Manual Updates

If goreleaser fails, you can manually update the AUR package:

1. Clone the AUR repo:
   ```bash
   cd lazysmtp-git
   ```

2. Update `PKGBUILD` with the new version:
   ```bash
   pkgver=1.0.0
   ```

3. Update checksums:
   ```bash
   makepkg -g
   ```

4. Commit and push:
   ```bash
   git add PKGBUILD
   git commit -m "Update to v1.0.0"
   git push
   ```

### Verify AUR Package

Install the package from AUR:
```bash
yay -S lazysmtp-git
# or
paru -S lazysmtp-git
# or
git clone https://aur.archlinux.org/lazysmtp-git.git
cd lazysmtp-git
makepkg -si
```

## Troubleshooting

### SSH Authentication Failed

Ensure your SSH key is properly configured:
```bash
ssh -T aur@aur.archlinux.org
```

### Goreleaser Fails

Check the `.goreleaser.yml` configuration and run:
```bash
goreleaser check
```

### AUR Package Rejected

Ensure:
- Package name is unique in AUR
- PKGBUILD follows AUR guidelines
- Dependencies are correct
- Package provides a binary at `/usr/bin/lazysmtp`

## AUR PKGBUILD Details

The auto-generated PKGBUILD will include:

```bash
pkgname=lazysmtp-git
pkgver=1.0.0
pkgrel=1
pkgdesc="A terminal-based SMTP testing tool for developers with TUI interface"
arch=('x86_64' 'aarch64')
url="https://github.com/yourusername/lazysmtp"
license=('MIT')
makedepends=('go')
depends=('sqlite')
provides=('lazysmtp')
conflicts=('lazysmtp')

build() {
    cd "$srcdir"
    go build -o lazysmtp ./src
}

package() {
    install -Dm755 "${srcdir}/lazysmtp" "${pkgdir}/usr/bin/lazysmtp"
    install -Dm644 "${srcdir}/LICENSE" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
```

## Additional Resources

- [AUR Guidelines](https://wiki.archlinux.org/title/Arch_User_Repository#Submitting_packages)
- [Goreleaser Documentation](https://goreleaser.com/)
- [Arch Packaging Standards](https://wiki.archlinux.org/title/Arch_package_guidelines)
